<div class="container">
  <!-- Header com Título -->
  <div class="header-section">
    <h1 class="page-title">Simulado de Questões</h1>
  </div>

  <!-- Área de Filtros -->
  <div class="filtros-section">
    <app-filtro (filtroAplicado)="aplicarFiltros($event)"></app-filtro>
  </div>

  <!-- Estatísticas -->
  <div *ngIf="!carregando" class="estatisticas-section">
    <div class="estatistica-card">
      <div class="estatistica-label">Total de Questões</div>
      <div class="estatistica-valor">{{ totalQuestoesDisponiveis }}</div>
    </div>
    <div class="estatistica-card">
      <div class="estatistica-label">Questões Respondidas</div>
      <div class="estatistica-valor">{{ totalQuestoesRespondidas }}</div>
    </div>
  </div>

  <div
    *ngIf="mensagem"
    class="mensagem"
    [ngClass]="{
      'mensagem-sucesso': tipoMensagem === 'sucesso',
      'mensagem-erro': tipoMensagem === 'erro',
      'mensagem-info': tipoMensagem === 'info'
    }"
  >
    <span class="mensagem-texto">{{ mensagem }}</span>
  </div>

  <!-- Indicador de Carregamento -->
  <div *ngIf="carregando" class="carregamento">
    <div class="spinner"></div>
    <p>Carregando questões...</p>
  </div>

  <div *ngIf="!mensagem && !carregando" class="questoes-lista">
    <div *ngFor="let questao of questoes; let i = index" class="questao-card">
      <div class="questao-tags">
        <div
          class="tag-row"
          *ngIf="questao.banca && questao.banca !== 'Não informada'"
        >
          <span class="tag tag-banca">{{ questao.banca }}</span>
        </div>
        <div class="tag-row" *ngIf="questao.prova">
          <span class="tag tag-prova">{{ questao.prova }}</span>
        </div>
        <div class="tag-row tag-row-inline">
          <span *ngIf="questao.cargo" class="tag tag-cargo">{{
            questao.cargo
          }}</span>
          <span *ngIf="questao.nivel" class="tag tag-nivel">{{
            questao.nivel
          }}</span>
        </div>
      </div>

      <p
        class="questao-enunciado"
        [innerHTML]="formatarEnunciado(questao.enunciado)"
      ></p>

      <img
        *ngIf="questao.imagem"
        [src]="'assets/images/' + questao.imagem"
        alt="Imagem da questão"
        class="imagem-questao"
      />

      <p *ngIf="questao.legendaImagem" class="legenda-imagem">
        {{ questao.legendaImagem }}
      </p>

      <div class="alternativas-lista">
        <div
          *ngFor="let alternativa of questao.alternativas"
          class="alternativa-item"
          [class.selecionada]="
            alternativaSelecionada[questao.id] === alternativa.id && !resultado
          "
          [class]="obterClasseAlternativa(questao.id, alternativa.id)"
          (click)="selecionarAlternativa(questao.id, alternativa.id)"
        >
          {{ alternativa.texto }}
        </div>
      </div>
    </div>
  </div>

  <div *ngIf="resultado !== null && !carregando" class="resultado-container">
    <div class="resultado-box">
      Você acertou {{ resultado.acertos }} questões de {{ questoes.length }} ({{
        resultado.percentual
      }}%)
    </div>
  </div>

  <div *ngIf="!carregando" class="botoes-container">
    <!-- Tooltip wrapper para permitir tooltip em botão desabilitado -->
    <span
      class="tooltip-wrapper"
      matTooltip="{{
        !todasQuestoesRespondidas()
          ? 'Responda todas as questões para corrigir'
          : 'Clique para corrigir o simulado'
      }}"
      matTooltipPosition="above"
    >
      <button
        class="corrigir-simulado-btn"
        (click)="corrigirSimulado()"
        [disabled]="!todasQuestoesRespondidas()"
      >
        Corrigir Simulado
      </button>
    </span>

    <button
      class="sortear-questoes-btn"
      (click)="sortearNovasQuestoes()"
      matTooltip="Sortear um novo conjunto de questões"
      matTooltipPosition="above"
    >
      Sortear Novas Questões
    </button>

    <span
      *ngIf="totalQuestoesRespondidas > 0"
      class="tooltip-wrapper"
      matTooltip="Limpar todas as questões respondidas do histórico"
      matTooltipPosition="above"
    >
      <button
        class="resetar-historico-btn"
        (click)="resetarHistoricoCompleto()"
      >
        Resetar Histórico
      </button>
    </span>
  </div>
</div>
